@model List<ProductGetDTO>
@{
    ViewData["Title"] = "Products";
}

<!-- Page Header Start -->
<div class="container-fluid bg-secondary mb-5">
    <div class="d-flex flex-column align-items-center justify-content-center" style="min-height: 300px">
        <h1 class="font-weight-semi-bold text-uppercase mb-3">Our Shop</h1>
        <div class="d-inline-flex">
            <p class="m-0"><a href="">Home</a></p>
            <p class="m-0 px-2">-</p>
            <p class="m-0">Shop</p>
        </div>
    </div>
</div>
<!-- Page Header End -->
<!-- Shop Start -->
<div class="container-fluid pt-5">
    <div class="row px-xl-5">
        <!-- Shop Sidebar Start -->
        <div class="col-lg-3 col-md-12">
            <!-- Price Start -->
            <div class="border-bottom mb-4 pb-4">
                <h5 class="font-weight-semi-bold mb-4">Filter by price</h5>
                <form>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" id="price-all">
                        <label class="custom-control-label" for="price-all">All Price</label>
                    </div>
                    @for (int i = 0; i < Model.Max(x => x.SalePrice - x.Discount); i += ((int)Model.Max(x => x.SalePrice - x.Discount)/5))
                    {
                        <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                            <input type="radio" class="custom-control-input price-check" name="prices" id="price-@i" value="@i - @(i + (int)Model.Max(x => x.SalePrice - x.Discount) / 5)">
                            <label class="custom-control-label" for="price-@i">@i - @(i + (int)Model.Max(x => x.SalePrice - x.Discount) / 5)</label>
                        </div>
                    }
                </form>
            </div>
            <!-- Price End -->
            <!-- Color Start -->
            <div class="border-bottom mb-4 pb-4">
                <h5 class="font-weight-semi-bold mb-4">Filter by color</h5>
                <form>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" id="color-all" value="color-all">
                        <label class="custom-control-label" for="color-all">All Color</label>
                    </div>
                    @foreach (Color color in ViewBag.Colors)
                    {
                        <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                            <input type="checkbox" class="custom-control-input color-check" value="@color.Id" id="color-@color.Id">
                            <label class="custom-control-label" for="color-@color.Id">@color.Name</label>
                        </div>
                    }
                </form>
            </div>

            <div class="border-bottom mb-4 pb-4">
                <h5 class="font-weight-semi-bold mb-4">Filter by category</h5>
                <form>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" id="color-all">
                        <label class="custom-control-label" for="color-all">All Color</label>
                    </div>
                    @foreach (Category category in ViewBag.Categories)
                    {
                        <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                            <input type="checkbox" class="custom-control-input category-check" value="@category.Id" id="category-@category.Id">
                            <label class="custom-control-label" for="category-@category.Id">@category.Name</label>
                        </div>
                    }
                </form>
            </div>

            <!-- Color End -->
            <!-- Size Start -->
            <div class="mb-5">
                <h5 class="font-weight-semi-bold mb-4">Filter by size</h5>
                <form>
                    <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                        <input type="checkbox" class="custom-control-input" id="size-all">
                        <label class="custom-control-label" for="size-all">All Size</label>
                    </div>
                    @foreach (Size size in ViewBag.Sizes)
                    {
                        <div class="custom-control custom-checkbox d-flex align-items-center justify-content-between mb-3">
                            <input type="checkbox" class="custom-control-input size-check" value="@size.Id" id="size-@size.Id">
                            <label class="custom-control-label" for="size-@size.Id">@size.Name</label>
                        </div>
                    }
                </form>
            </div>
            <!-- Size End -->
        </div>
        <!-- Shop Sidebar End -->
        <!-- Shop Product Start -->
        <div class="col-lg-9 col-md-12">
            <div class="row pb-3">
                <div class="col-12 pb-1">
                    <div class="d-flex align-items-center justify-content-between mb-4">
                        <form action="">
                            <div class="input-group">
                                <input type="text" class="form-control" id="search" placeholder="Search by name">
                                <div class="input-group-append">
                                    <span class="input-group-text bg-transparent text-primary">
                                        <i class="fa fa-search"></i>
                                    </span>
                                </div>
                            </div>
                        </form>
                        <div class="dropdown ml-4">
                            <button class="btn border dropdown-toggle" type="button" id="triggerId" data-toggle="dropdown" aria-haspopup="true"
                                    aria-expanded="false">
                                Sort by
                            </button>
                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="triggerId">
                                <a class="dropdown-item" href="#">Latest</a>
                                <a class="dropdown-item" href="#">Popularity</a>
                                <a class="dropdown-item" href="#">Best Rating</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="products-all row">
                    @await Html.PartialAsync("_ProductPartial",Model)
                </div>
                <div class="col-12 pb-1">
                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-center mb-3">
                            <li class="page-item disabled">
                                <a class="page-link" href="#" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                    <span class="sr-only">Previous</span>
                                </a>
                            </li>
                            <li class="page-item active"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                    <span class="sr-only">Next</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
        <!-- Shop Product End -->
    </div>
</div>
<!-- Shop End -->

@section Scripts{
    <script>

        let colorChecks = document.querySelectorAll('.color-check');
        let categoryChecks = document.querySelectorAll('.category-check');
        let sizeChecks = document.querySelectorAll('.size-check');
        let priceChecks = document.querySelectorAll('.price-check');
        let search = document.getElementById('search');

        search.addEventListener('input',function(){
            filter();
        });

        colorChecks.forEach(color=>{
            color.addEventListener('click',function(){
                filter();
            })
        });

        sizeChecks.forEach(size => {
            size.addEventListener('click', function () {
                filter();
            })
        });

        categoryChecks.forEach(category => {
            category.addEventListener('click', function () {
                filter();
            })
        });

        priceChecks.forEach(priceCheck=>{
            priceCheck.addEventListener('click',function(){
                filter();
            });
        });


        function filter(){
            let colors = [];
            let sizes = [];
            let min = '';
            let max = '';
            let categories = [];
            colorChecks.forEach(colorCheck=>{
                if(colorCheck.checked == true){
                    colors.push(colorCheck.value);
                }
            });

            sizeChecks.forEach(sizeCheck => {
                if (sizeCheck.checked == true) {
                    sizes.push(sizeCheck.value);
                }
            });

            categoryChecks.forEach(categoryCheck=>{
                if(categoryCheck.checked == true){
                    categories.push(categoryCheck.value);
                }
            });

            priceChecks.forEach(priceCheck => {
                if (priceCheck.checked == true) {
                    min = priceCheck.value.split(' - ')[0];
                    max = priceCheck.value.split(' - ')[1];
                }
            });


            let url = `/product/filter?search=${search.value}&size=${sizes.join(',')}&color=${colors.join(',')}&category=${categories.join(',')}&min=${min}&max=${max}`
            fetch(url)
                .then(res=>res.text())
                .then(data=>{
                    document.querySelector('.products-all').innerHTML = data;
                });
        }
    </script>
}
